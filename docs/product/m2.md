# M2 PRD — Sidebar + Cookie Consent/Grab

## Overview
This milestone implements Feature Slice 2 from the roadmap: a sidebar with cookie capture and validation. Users can explicitly grab cookies from ReserveAmerica, see validity (JWT expiry, a1Data JSON), and the app auto‑refreshes when cookies change.

## Goals
- Provide a clear, reliable way to load `idToken` (JWT) and `a1Data` from the user’s live RA session.
- Validate and present cookie health without exposing sensitive values.
- Auto‑refresh state when RA updates cookies (no restart).

## Non‑Goals (M2)
- Countdown/prewarm/polling.
- Context extraction (facility/site) and booking form.
- Packaging/signing.

## In‑Scope
1) Sidebar “Auth” section
   - “Grab cookies” button (explicit user action/consent).
   - Display:
     - JWT status: valid/invalid, expiry timestamp.
     - a1Data status: URL‑decode + JSON parse result, length only.
   - Do not show raw cookie values; do not persist to disk.

2) Auto‑refresh on change
   - Subscribe to Electron cookie change events.
   - When `idToken` or `a1Data` changes, UI revalidates and updates indicators.

3) Polished UX
   - Status chips (valid/invalid).
   - “Please log in” banner/CTA when cookies are missing/invalid.
   - Tailwind styling consistent with our camp aesthetic.

4) Auto-grab and login routing (instructions)
   - On app load, attempt to read cookies immediately.
   - If JWT is present and valid → populate status without any click; hide the “Grab cookies” button.
   - If JWT is missing/invalid → navigate the embedded RA view to the sign-in page and show a clear prompt to log in.
   - Retain the button only as a fallback if auto-grab proves unreliable in edge cases.

## Functional Requirements
- Read cookies via `session.cookies.get({ domain: 'www.reserveamerica.com' })` after user action.
- Decode JWT payload (base64url), check `exp`.
- Try `decodeURIComponent` + `JSON.parse` for a1Data.
- Subscribe to `session.cookies.on('changed', ...)` for live updates.
- Never log/persist tokens; show metadata only.

## Acceptance Criteria
- Clicking “Grab cookies” loads and validates JWT + a1Data.
- On load with valid session, cookies are auto-detected and displayed without clicking.
- On load without a valid session, app routes to RA sign-in and prompts the user.
- JWT expiry is shown; a1Data parse status and length shown.
- When RA updates cookies, UI updates within ~1s (no restart).
- If cookies are missing/invalid, a login banner/CTA appears.
- No sensitive values are displayed or stored.

## Risks
- Some RA environments/cookie settings may delay change events; we still provide manual refresh.
- JWT formats can vary; we defensively decode and fall back to “invalid” if parsing fails.


