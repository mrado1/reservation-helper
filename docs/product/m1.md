# M1 PRD — Reserve America Helper

## Overview
M1 delivers a minimal, testable desktop experience that embeds Reserve America (RA) in an Electron shell with a guided sidebar. Users can log in within the app, grab cookies with consent, see campsite context as they browse RA, and configure a booking plan (start date + nights) with validation and a clear date range. No automated booking yet.

## Problem
Booking highly competitive campsites requires precise setup and valid session tokens. Today this is a bash script that is hard to use and error-prone. M1 reduces setup friction and prepares users for automated booking in later milestones.

## Goals
- Run RA in-app, restricted to RA domains.
- Let users grab and validate `idToken` (JWT) and `a1Data` with explicit consent.
- Auto-refresh token values when RA updates cookies.
- Detect facility/site context from the RA page and display human-friendly context.
- Provide a booking form (start date, nights) that shows the derived date range and validates inputs.

## Non‑Goals (M1)
- No countdown, no automated add-to-cart, no cart navigation (these are M2+).
- No packaging/signing for distribution (developer runs OK; packaging is later).
- No persistent storage of tokens (memory only in M1).

## In‑Scope (Feature Slices mapped)
1) Electron shell + RA navigation lock
2) Sidebar scaffold + cookie consent/grab (+ auto-refresh when cookies change)
3) Facility/site context detection (from URL, enriched from DOM)
4) Booking form + validation (date range derived from start date + nights)

## User Stories
- As a user, I can open RA inside the app and browse normally (within RA).
- As a user, I can click “Grab cookies” to load `idToken` and `a1Data` and see if they are valid.
- As a user, when RA refreshes my session, the app updates tokens automatically.
- As a user, when I navigate to a campsite/date page, I can see facility/site IDs and friendly names in the sidebar.
- As a user, I can enter a start date and number of nights and see the derived date range.

## UX Requirements
- Split view layout:
  - Right: RA website.
  - Left: Sidebar with sections: Auth, Current Page Info, Booking Form.
- Auth section:
  - “Grab cookies” button (consent gate).
  - JWT: show expiry, validity; `a1Data`: show parse state and length (no raw value).
  - Auto-refresh indicator when cookies update.
- Current Page Info:
  - facilityID, siteID; location name (e.g., “Lake George, NY”), site name (e.g., “BB011”) when available.
- Booking Form:
  - Inputs: Start date (date picker), Nights (>=1).
  - Derived: End date and human-readable date range (nights-based).
  - Validation errors inline with clear copy.

## Functional Requirements
- RA window:
  - Allowlist navigation to RA domains; block others or open externally.
  - Open external links in system browser.
- Cookies:
  - On demand, read `idToken` and `a1Data` via Electron `session.cookies` (with user action).
  - Validate `idToken` (decode, check `exp`); URL-decode and JSON-parse `a1Data`.
  - Subscribe to cookie changes; auto-refresh values in UI when they change.
- Context detection:
  - Parse facilityID/siteID from URL; enrich location/site name from DOM selectors if present.
- Booking form:
  - Validate required inputs; compute end date and date range.
  - No network calls in M1 from the form submission.

## Validation Rules
- JWT valid if `exp * 1000 > now`; display expiry timestamp and time remaining.
- `a1Data` valid if decodeURIComponent succeeds and JSON parses.
- Start date must be a valid date; Nights is integer >= 1.

## Performance & Reliability
- Context extraction should update within 1 second of navigation to a campsite page.
- Cookie change events reflected in UI within 1 second.

## Security & Privacy
- Tokens live in memory only; do not persist to disk in M1.
- Do not log raw tokens; show minimal metadata (expiry, length).
- No data leaves the user’s machine.

## Acceptance Criteria
- RA loads and is navigable; external navigation is blocked/opened externally.
- “Grab cookies” loads `idToken` and `a1Data`, validates both, and shows status.
- Changing cookies in RA updates the app’s displayed token status automatically.
- Navigating to a campsite page shows facility/site IDs and friendly names when available.
- Booking form computes and displays date range; blocks invalid inputs.

## Milestone Exit Criteria
- All Acceptance Criteria met on both macOS and Windows in developer builds.
- Smoke test script executed:
  - Load RA, log in, grab cookies → valid.
  - Navigate to campsite → context shows.
  - Enter booking form data → derived range correct; validation accurate.

## Risks
- DOM structure changes on RA pages may break name extraction (fallback to IDs only).
- Cookie refresh timing varies across users; ensure graceful UI hints to re-login if needed.

## Metrics (Qualitative for M1)
- Time to first valid cookie grab (user unblocked).
- % of navigations where context is detected within 1s.



