# M9 — Information Architecture & Guided Flow

## Goal
Reshape the app’s information architecture so that booking on Reserve America feels like a **guided, three-step flow** instead of a collection of disconnected controls. M9 focuses on a tighter, application-style layout: a stepped sidebar with clear instructions and status, plus a dedicated Logs view, without materially changing the underlying booking behavior.

## Primary User Stories
- **As a first-time user**, I want the app to walk me through the three critical steps (sign in, find site, reserve site), so I always know what to do next and what’s already done.
- **As a returning user**, I want the sidebar to show a concise, parallel summary of my state (auth, site context, booking data, polling status) so I can quickly confirm I am ready for the next drop.
- **As a power user**, I want a separate Logs view that shows a tight, minimal history of requests and responses, so I can debug why a run behaved a certain way without being overwhelmed.
- **As the developer**, I want the layout and IA to be clean and consistent, so future features (cart helpers, settings, etc.) can be slotted into the structure without a redesign.

## Scope

### In Scope
- **Sidebar Information Architecture**
  - Replace the current “camp themed” sidebar with a **minimal, application-style** layout that visually matches the address bar.
  - Introduce a **vertical 1–2–3 stepper**:
    1. **Sign in**
    2. **Find site**
    3. **Reserve site**
  - Each step includes: header, subheader/instructions, status text, and relevant data (e.g., cookie validity, facility/site info, booking details).
  - Each step visually reflects completion state (inactive, active, complete) based on existing app signals.

- **Booking Tab (default sidebar tab)**
  - Step 1 (Sign in):
    - Surface auth state: “Cookies captured”, JWT/a1Data validity, live auth probe result.
    - When not signed in, show a clear header and helper text instructing the user to sign in in the main RA window.
    - When signed in, mark the step as complete and show a concise summary of cookie state.
  - Step 2 (Find site):
    - Integrate existing **Context** information (facility ID, site ID, facility/site names).
    - Provide helper copy that tells the user to browse to a campsite booking page.
    - When context is fully populated, mark the step as complete and show a one-line summary (e.g., “Glen Island · Site 12”).
  - Step 3 (Reserve site):
    - Integrate the existing **Booking form** (start date, nights, derived range) and **Polling status** (state, request count, elapsed, last status, last message).
    - The primary action button reflects current mode:
      - “Add to Cart” when we can start immediately.
      - “Queue Cart” when we are before the 9‑month or daily unlock window.
    - During queue mode:
      - Show a callout describing unlock time (e.g., “Reservation unlocks at 9:00 AM on 11/17/2025. We’ll queue this and auto‑start at 08:59:55. Keep this app open and return by 09:00 to complete checkout.”).
      - Show countdown block (current time, target time, countdown clock).
    - During polling/after completion:
      - Keep the step’s status in sync with the existing polling state (idle, queue armed, polling, success, error/stopped).

- **Logs Tab (secondary sidebar tab)**
  - Top-level tabs in the sidebar: **Booking** (default) and **Logs**.
  - Logs tab shows a compact, chronological list of:
    - Probe attempts and responses (pre‑queue check).
    - Polling status changes (state, HTTP status, server messages).
  - Presentation:
    - Timestamp, source (probe/polling), HTTP code, and primary message in each row.
    - No emojis; simple textual labels.
    - Deduplicated enough to avoid flooding (rely on existing polling dedup logic).

- **Copy and Visual Style**
  - Remove emojis from status labels and helper copy; use plain, descriptive text.
  - Use a consistent, system-style type stack (matching the existing Inter/system font setup).
  - **Key/value alignment**:
    - Same font family and size for both keys and values.
    - Keys: muted gray.
    - Values: standard black/near-black.
  - Replace “camp” theme and decorative styling with a flatter, application-style look that matches the address bar and top chrome.

### Out of Scope (M9)
- Changes to the underlying polling logic, concurrency behavior, or RA integration.
- New cart flows (e.g., cart clearing, overlapping-reservation helpers).
- New configuration storage or advanced settings UI.
- Changes to packaging, distribution, or app naming beyond what is already defined in M8.

## UX Requirements

### Stepper Behavior
- **Step 1: Sign in**
  - Initial state:
    - Header: “Sign in”.
    - Helper: instructs user to sign in to Reserve America in the main window.
    - Status: “Not signed in”.
  - When valid JWT + a1Data cookies are present and live auth probe passes:
    - Mark step as **complete**.
    - Status: “Signed in”.
    - Data: a short line summarizing cookie validity (e.g., “JWT valid · a1Data valid JSON”).
  - If auth later fails (probe 401/403), revert the step to an incomplete/error state and prompt to sign in again.

- **Step 2: Find site**
  - Initial state:
    - Header: “Find a site”.
    - Helper: instructs user to search for a campsite and open its booking page.
    - Status: “Waiting for campsite”.
  - When facility/site context is detected:
    - Mark step as **complete** when both facility ID and site ID are populated and DOM labels are extracted.
    - Show one-line summary with names and IDs.
  - If context becomes invalid (user navigates elsewhere), step returns to active/incomplete state.

- **Step 3: Reserve site**
  - Initial state:
    - Header: “Reserve site”.
    - Helper: brief instructions to fill the form and queue/add to cart.
    - Status: “Not started”.
  - When the form is valid and mode is **Queue** (future unlock):
    - Action button: “Queue Cart”.
    - Show unlock callout and highlight that the app will auto-start around 08:59:55 on the unlock day.
    - If RA responds with a 9‑month rule message, copy under polling status includes guidance:
      - “Your arrival day has to be within 9 Month(s) from today. Please choose an arrival date on or before Sunday August 16, 2026. Please come back the day the reservation opens before 9:00 AM to queue.”
  - When the form is valid and mode is **Add** (window is open):
    - Action button: “Add to Cart”.
  - While a run is queued or active:
    - Step 3 status reflects “Queue armed” or “Polling in progress”.
    - Button shows a loading/busy state as appropriate (probing, queued, polling), tied to existing request lifecycle.
  - On success:
    - Mark step as **complete** (“Added to cart.”).
    - Keep the existing behavior that navigates the RA webview to the cart.
  - On terminal error or manual stop:
    - Status: “Stopped” or “Error” with short explanation.

### Logs Tab UX
- Booking/log tabs should feel like standard app tabs (no theme imagery).
- Logs list:
  - Most recent events visible without scrolling in typical window height.
  - Each row uses a single line of main copy (truncation + tooltip is acceptable).
  - No raw JSON blobs; messages should be the same human-readable strings the polling system already produces.
- Empty state:
  - Message like: “No logs yet. Start a probe or polling run to see activity.”

## Acceptance Criteria
- **Structure**
  - Sidebar shows a clear 1–2–3 vertical stepper in the Booking tab, with each step containing header, helper text, status, and relevant data.
  - Existing Auth, Context, Booking form, and Polling status information are preserved and mapped into the new step framework.
  - Logs tab is available in the sidebar and shows a concise history of probe/polling events.

- **Behavior**
  - Login state changes correctly mark Step 1 as complete/incomplete.
  - Context detection correctly marks Step 2 as waiting/complete and shows site information.
  - Queue/Add behavior and countdown operate as in previous milestones, with updated copy and without breaking the polling state machine.
  - The “too early” (9‑month rule) and daily unlock “queue” cases still behave as before, with updated, clearer copy in both the unlock callout and polling status.

- **Visual & Copy Consistency**
  - No emojis in labels, callouts, or status chips in the sidebar.
  - Key/value text uses a single, consistent sans-serif font; keys are gray, values are dark.
  - Sidebar styling is flattened and application-like, visually aligned with the top address bar and controls (no remaining “camp” theme elements).

- **Non-regression**
  - User can still: sign in, capture cookies, navigate to a site, configure the booking form, queue/add, and land in the cart on success.
  - Polling stop conditions and resilience behavior (from M6/M7) remain intact.

## Risks & Mitigations
- **Users lose familiarity with old layout**
  - Mitigation: Maintain the same underlying flow and terminology; the milestone is an IA refactor, not a behavior change.
- **Stepper and Logs views drift out of sync with real state**
  - Mitigation: Treat the stepper and Logs as pure views over existing state/events; avoid adding new, conflicting state machines.
- **Information overload in Logs**
  - Mitigation: Keep messages short, rely on existing dedup logic, and only surface meaningful transitions and request summaries.


