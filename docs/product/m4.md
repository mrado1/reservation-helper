# M4 PRD — Booking Form + Validation

## Overview
This milestone implements Feature Slice 4 from the roadmap: a validated booking form that captures start date and number of nights, displays the derived date range, and ensures all required fields are valid before allowing the user to proceed to reservation.

## Goals
- Provide clear inputs for start date and number of nights
- Display a human-readable date range derived from nights (not end date)
- Validate inputs and prevent invalid booking attempts
- Integrate with context from M3 (facility/site IDs)

## Non-Goals (M4)
- Countdown/prewarm/polling worker (M5)
- Actual API calls to Reserve America (M5)
- Settings/configuration UI
- Packaging/signing

## In-Scope
1) **Booking form inputs**
   - Start date picker (HTML5 date input)
     - Default value: today's date + 9 months (RA's typical booking window)
     - User can select earlier dates if availability exists
     - No validation against 9-month rule (RA will validate server-side)
   - Nights input (number, minimum 1, maximum 14)
     - Default value: 1
   - Both fields required

2) **Date range display**
   - Derived from start date + nights
   - Format: "May 17, 2026 → May 18, 2026 (1 night)" or "(2 nights)"
   - Updates in real-time as user changes inputs
   - Clear, human-readable format

3) **Validation**
   - Start date must be selected
   - Nights must be ≥1 and ≤14
   - Display validation errors inline
   - Disable "Reserve" button when invalid
   - Clear error messages guide user to fix issues
   - No client-side validation of 9-month booking window (RA handles server-side)

4) **Reserve button**
   - Disabled state when form invalid or context incomplete
   - Enabled when: valid date + nights + facility/site IDs present
   - Visual feedback (disabled styling)
   - Tooltip or helper text explaining why disabled

5) **Integration with context**
   - Use facility/site IDs from M3 context
   - Show warning if user tries to reserve without navigating to a campsite
   - Button disabled if context status is "unknown"

## Functional Requirements
- Start date input uses native HTML5 date picker
  - Default value: `new Date(Date.now() + 9 * 30 * 24 * 60 * 60 * 1000)` (approximately 9 months from today)
  - User can select any date (no client-side restriction)
- Nights input enforces minimum value of 1, maximum value of 14
  - Default value: 1
- Date range calculation: `endDate = startDate + nights`
- Validation runs on input change (real-time)
- Error messages appear inline below relevant field
- "Reserve" button only enabled when all conditions met:
  - Valid start date selected
  - Nights ≥ 1 and ≤ 14
  - Context status is "complete" or "partial" (has IDs)
- Form state persists during navigation (optional enhancement)

## UI/UX Requirements
- Form follows existing camp aesthetic (Tailwind styling)
- Date range prominently displayed
- Validation errors in red, clear and concise
- Disabled button has reduced opacity and cursor-not-allowed
- Helper text explains what's needed to enable "Reserve"
- Smooth transitions for error messages (no jarring layout shifts)

## Acceptance Criteria
- Form loads with default values: date 9 months from today, nights = 1
- User can select start date and enter nights (1-14)
- Date range displays correctly and updates in real-time
- Invalid inputs show error messages:
  - No date selected
  - Nights < 1 or > 14
- "Reserve" button disabled when form invalid
- "Reserve" button disabled when not on a campsite page
- "Reserve" button enabled when all conditions met
- Clicking "Reserve" (when enabled) logs form data to console (M5 will implement actual reservation)

## Edge Cases
- User changes date/nights rapidly → debounce validation
- User navigates away from campsite → button disables
- Start date in the past → allow (RA will validate server-side)
- Start date beyond 9 months → allow (user may want to book earlier if available)
- Nights > 14 → show validation error, enforce maximum
- Empty/cleared date field → show validation error

## Success Metrics (M4)
- Form validation prevents invalid submissions
- Date range calculation is accurate
- User can easily understand why "Reserve" is disabled
- No console errors during form interaction

## Future Enhancements (Post-M4)
- Date range picker (select start and end dates visually)
- Calendar view showing availability
- Preset options (weekends, week-long trips)
- Save/load booking configurations
- Validate against RA's 9-month booking window

## Open Questions
- Should we pre-fill dates from URL query params if present?
- Should form state persist across app restarts?
- Should we show a helper tooltip explaining the 9-month default?


